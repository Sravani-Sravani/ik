<%@page import="com.liferay.portal.kernel.dao.orm.RestrictionsFactoryUtil"%>
<%@page import="com.liferay.portal.kernel.dao.orm.DynamicQuery"%>
<%@page import="com.liferay.portal.kernel.util.ParamUtil"%>   
<%@page import="com.liferay.portal.kernel.util.ListUtil"%>
<%@page import="javax.portlet.PortletURL"%>
<%@page import ="com.liferay.portal.kernel.dao.orm.OrderFactoryUtil"%>
<%@page import="com.kpmg.citizenTables.model.Ministry"%>
<%@page import="com.kpmg.citizenTables.service.MinistryLocalServiceUtil"%>
<%@page import="com.kpmg.citizenTables.service.InfraKnowledgeSubCategoryLocalServiceUtil"%>
<%@page import="com.kpmg.citizenTables.service.InfraKnowledgeCategoryLocalServiceUtil"%>
<%@page import="java.util.List"%>
<%@page import="com.kpmg.infraknowledge.portlet.InfraKnowledgePortlet"%>
<%@page import="com.kpmg.infraknowledge.constants.InfraKnowledgePortletKeys"%>
<%@page import="com.kpmg.citizenTables.service.InfraKnowledgeLocalServiceUtil"%>
<%@page import="com.kpmg.citizenTables.model.InfraKnowledge"%>
<%@page import="com.kpmg.citizenTables.model.InfraKnowledgeCategory"%>
<%@page import="com.kpmg.citizenTables.model.InfraKnowledgeSubCategory"%>
<%@page import="java.text.SimpleDateFormat"%>
<%@page import="com.liferay.portal.kernel.util.PortalUtil"%>
<portlet:resourceURL var="getMinistryOption1"></portlet:resourceURL>
<%
int pageSize = 9;
int currentPage = 1;

String currURL = "";
String type = "";
long tab = 0L;
try {
    currURL = PortalUtil.getCurrentURL(request);
    System.out.println("currURL=" + currURL);
    String[] strArray = null;
    strArray = currURL.split("\\?");
    if (strArray.length > 1) {
        String[] mainArray = null;
        mainArray = strArray[1].split("\\&");
        for (int i = 0; i < mainArray.length; i++) {
            String[] subArray = null;
            subArray = mainArray[i].split("\\=");
            if (subArray.length > 0) {
                System.out.println("subArray[0]=" + subArray[0]);
                if (subArray[0].equalsIgnoreCase("tab")) {
                    if (subArray[1] != "") {
                        System.out.println("subArray[1]=" + subArray[1]);
                        tab = Long.valueOf(subArray[1]);
                    }
                } else if (subArray[0].equalsIgnoreCase("type")) {
                    type = String.valueOf(subArray[1]);
                    System.out.println("Type:" + type);
                }
            }
        }
    }
} catch (Exception e) {
    e.printStackTrace();
}

if (type.equals("PAG"))
    type = "CENTRAL POLICIES";
if (type.equals("IFS"))
    type = "PPP DOCUMENT REPOSITORY";
System.out.println(type);

try {
    currentPage = ParamUtil.getInteger(request, "page", 1);
} catch (NumberFormatException e) {
    currentPage = 1;
}

int start = (currentPage - 1) * pageSize;
%>
<section class="top_innerBanner" style="margin-top: -60px !important;">
    <div class="container top_bannerImg d-flex align-items-center flex-wrap">
        <div class="me-auto"><h1>Transport &amp; Infrastructure</h1></div>
    </div>
</section>

<section class="ministry_details">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <%
                List<InfraKnowledge> ikd = null;
                DynamicQuery dq1 = InfraKnowledgeLocalServiceUtil.dynamicQuery();
                dq1.add(RestrictionsFactoryUtil.eq("type", type));
                dq1.add(RestrictionsFactoryUtil.eq("cateId", tab));
                try {
                    ikd = InfraKnowledgeLocalServiceUtil.dynamicQuery(dq1, start, pageSize);
                } catch (Exception e) {
                    e.printStackTrace();
                }
                if (ikd != null && !ikd.isEmpty()) {
                    for (InfraKnowledge ik : ikd) {
                        %>
                        <div class="row">
                            <!-- Resource cards loop -->
                            <div class="col-12">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title"><%= ik.getTitle() %></h5>
                                        <p class="card-text"><%= ik.getDescription() %></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }
                } else { %>
                    <div class="row">
                        <div class="col-12">
                            <div class="alert alert-info" role="alert">
                                No resources found.
                            </div>
                        </div>
                    </div>
                <% } %>

                <div class="row">
                    <ul class="pagination justify-content-center mt-2">
                        <% int totalPages = (int) Math.ceil(ikd.size() / (double) pageSize);
                        for (int i = 1; i <= totalPages; i++) { %>
                            <li class="page-item <%= currentPage == i ? "active" : "" %>">
                                <a class="page-link" href="<%= currURL + "?page=" + i %>"><%= i %></a>
                            </li>
                        <% } %>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
