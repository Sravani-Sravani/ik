<main class="main_innerlayout">
	
	<%
	JSONArray jsonArray = JSONFactoryUtil.createJSONArray();
	 Date todayDate1 = new Date();
    todayDate1.setHours(0);
    todayDate1.setMinutes(0);
    todayDate1.setSeconds(0);
    List<Events> eventLinksot1 = null;
    DynamicQuery dqot = EventsLocalServiceUtil.dynamicQuery(); 
    dqot.add(RestrictionsFactoryUtil.eq("eventtype", "Training"));
    dqot.add(RestrictionsFactoryUtil.eq("trainingpartner", "Offline Training"));
    eventLinksot1 = EventsLocalServiceUtil.dynamicQuery(dqot);
    try {
        eventLinksot1= EventsLocalServiceUtil.dynamicQuery(dqot, 0,
                EventsLocalServiceUtil.getEventsesCount());
    } catch (Exception e) {
        e.printStackTrace();
    }
    for(Events data:eventLinksot1) {
    	SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss.S");
       	JSONObject jsonOb = JSONFactoryUtil.createJSONObject();
       	jsonOb.put("groupId", data.getEventId());
       	long evid=data.getEventId();
       	String str = data.getTitle();
        String languageId1=themeDisplay.getLanguageId();
        //System.out.println("Capacity Building Language Id:"+languageId1);
       	if(languageId1.equals("hi_IN")){
       		str=data.getHi_title();
       		System.out.println(str);
       	}
                  String startDate = ""; 
       	            String link="/eventlist?eventId="+evid+"&eventtype=Training";
           String endDate = ""; 
           String st="";
           String et="";
           try{	
   			Date dt = data.getStartDate();
   			Date dt1 = data.getEndDate();
   			startDate = sdf.format(dt);
   			endDate=sdf.format(dt1);
   			String starttime=data.getStartTime();
   			String endtime=data.getEndTime();
   			 st=startDate.substring(0,10)+" "+starttime+":00.0";
   			 System.out.println(startDate);
   			System.out.println(st);
   		    et=endDate.substring(0,10)+" "+endtime+":00.0";
   			System.out.println(et);
   		}catch(Exception e){
   			e.printStackTrace();
   		}
           jsonOb.put("title",str);
           jsonOb.put("start",st);
           jsonOb.put("end",et);
           jsonOb.put("url",link);
           jsonArray.put(jsonOb);

           }
   /*  System.out.println(eventLinksot1.size());
    System.out.println("JSON ARRAY Length:"+jsonArray.length());
    System.out.println(jsonArray.toString());
    System.out.println("Today Date:"+todayDate1); */
    String newdate = new SimpleDateFormat("yyyy-MM-dd").format(todayDate1);
   // System.out.println("Formatted Date_____"+newdate);
	%>
	<script src='<%=renderRequest.getContextPath()%>/js/index.global.js'></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
   <%--  var jsonArrayString= '<%=jsonArray.toString()%>'
    var events= JSON.parse(jsonArrayString);  --%>
    var events1=<%=jsonArray.toString()%>;
    console.log(events1);
    var date1="<%=newdate%>"
    console.log("date:"+date1);
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialDate: date1,
      initialView: 'timeGridWeek',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
      },
      height: 'auto',
      navLinks: true, // can click day/week names to navigate views
      editable: true,
      selectable: true,
      selectMirror: true,
      nowIndicator: true,
      events: events1
    });
    calendar.render();
    console.log(events1);
  });
</script>
<style>

 

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
}


  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }
</style>
<section  >
  <div class="container">
  <div class="main_heading"><h1>Offline Training</h1></div>
<div id='calendar'></div>
</div>
</section>
<section class="light_bg my-0" style="padding: 60px 0;">
  <div class="container">
    <div class="row d-flex align-items-start">
      <div class="col-lg-3">
        <h3 class="sub_heading">Online Training</h3>
       <!--  <p class="large_text">Placeholder for text.</p> -->
      </div>
      <div class="col-lg-9">
        <div class="container online_training">
          <% 
          Date todayDate11 = new Date();
          todayDate11.setHours(0);
          todayDate11.setMinutes(0);
          todayDate11.setSeconds(0);
          List<Events> eventLinks1 = null;
          DynamicQuery dq = EventsLocalServiceUtil.dynamicQuery(); 
          dq.add(RestrictionsFactoryUtil.eq("eventtype", "Training"));
          dq.add(RestrictionsFactoryUtil.eq("trainingpartner", "Online Training"));
          eventLinks1 = EventsLocalServiceUtil.dynamicQuery(dq);
          try {
              eventLinks1= EventsLocalServiceUtil.dynamicQuery(dq, 0,
                      EventsLocalServiceUtil.getEventsesCount());
          } catch (Exception e) {
              e.printStackTrace();
          }
          int totalItems = eventLinks1.size();
          for (Events eventLink : eventLinks1) {
        	  SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
              String title = eventLink.getTitle();
              long eid=eventLink.getEventId();
              String startDate = ""; 
              try{	
      			Date dt = eventLink.getStartDate();
      			startDate = sdf.format(dt);
      		}catch(Exception e){
      			e.printStackTrace();
      		}
           //   System.out.println(startDate);
          %>
          <div class="card">
            <a href="#"><%= title %></a>
            <div class="card-footer">
              <p class="d-flex align-items-center flex-wrap">
                <span class="me-auto"><%= startDate %></span>
                <a onClick="viewRecords1('<%=eid %>');" class="arrow_button">Read More <i class="fa-regular fa-chevrons-right"></i></a>
              </p>
            </div>
          </div>
          <% } %>
          <!-- End of JSP code replacement -->
        </div>
        <ul id="pagination" class="pagination justify-content-end">
          <!-- Pagination links will be dynamically added here -->
        </ul>
      </div>
    </div>
  </div>
</section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    var initialItemsPerPage = 4; // Number of items to display on the first page
    var remainingItemsPerPage = 4; // Number of items to display on the remaining pages
    function showItems(page) {
      var itemsPerPage = (page === 1) ? initialItemsPerPage : remainingItemsPerPage;
      var startIndex = (page - 1) * itemsPerPage;
      var endIndex = startIndex + itemsPerPage;
      $(".online_training .card").hide();
      $(".online_training .card").slice(startIndex, endIndex).show();
    }
    function generatePagination() {
      var totalItems = $(".online_training .card").length; // Total number of items
      var totalPages = Math.ceil(totalItems / remainingItemsPerPage); // Calculate total number of pages
      var pagination = $("#pagination");
      pagination.empty();
      if (currentPage > 1) {
        pagination.append('<li class="page-item"><a class="page-link" href="#" data-page="' + (currentPage - 1) + '"><i class="fa-regular fa-chevrons-left"></i></a></li>');
      }
      else
	  {
	  pagination.append('<li class="page-item disabled"><a class="page-link" href="#"><i class="fa-regular fa-chevrons-left"></i></a></li>');
	  }
      for (var i = 1; i <= totalPages; i++) {
        var activeClass = (i === currentPage) ? "active" : "";
        pagination.append('<li class="page-item ' + activeClass + '"><a class="page-link" href="#" data-page="' + i + '">' + i + '</a></li>');
      }
      if (currentPage < totalPages) {
        pagination.append('<li class="page-item"><a class="page-link" href="#" data-page="' + (currentPage + 1) + '"><i class="fa-regular fa-chevrons-right"></i></a></li>');
      }
      else
	  {
	  pagination.append('<li class="page-item disabled"><a class="page-link" href="#"><i class="fa-regular fa-chevrons-right"></i></a></li>');
	  }
    }
    $("#pagination").on("click", ".page-link", function(e) {
      e.preventDefault();
      var page = parseInt($(this).data("page"));
      currentPage = page;
      showItems(currentPage);
      generatePagination();
    });
    var currentPage = 1;
    showItems(currentPage);
    generatePagination();
  });
</script>
 <section id="mediagallery_section" class="py-5 my-0">
    <div class="container">
        <div class="main_heading">
            <h1>Media Gallery &amp; Videos</h1>
        </div>
        <div class="row mediagallery_slider mediagallery_card">
            <% 
         //   ThemeDisplay themeDisplay = (ThemeDisplay) request.getAttribute(WebKeys.THEME_DISPLAY);
            Date todayDate = new Date();
            todayDate.setHours(0);
            todayDate.setMinutes(0);
            todayDate.setSeconds(0);
            List<Events> eventLinks = null;
            DynamicQuery dq1 = EventsLocalServiceUtil.dynamicQuery(); 
            dq1.add(RestrictionsFactoryUtil.eq("eventtype", "Training"));
            eventLinks = EventsLocalServiceUtil.dynamicQuery(dq1);

            try {
                eventLinks= EventsLocalServiceUtil.dynamicQuery(dq1, 0,
                		EventsLocalServiceUtil.getEventsesCount());
            } catch (Exception e) {
                e.printStackTrace();
            }

            int x = 1;
            for (Events eventLink : eventLinks) {
                /* if (x > 4) {
                    break;
                }  */
                String color="";
          	  if(x%4==0)
          		  color="green";
          	  else if(x%4==1)
          		  color="red";
          	  else if(x%4==2)
          		  color="yellow";
          	  else if(x%4==3)
          		  color="blue";
                String eventtype=eventLink.getEventtype();
                System.out.println(eventtype);
                long eventid = eventLink.getEventId();
                List<YouTubeLinks> yl = YouTubeLinksLocalServiceUtil.findByeventId(eventid);
                List<GalleryDocuments> galleryDocumentsList = GalleryDocumentsLocalServiceUtil.findByeventId(eventid);
                String youtubelink="";
                if (galleryDocumentsList.size()>0) {
                    %>
                    <div class="col-md-4 col-lg-3 col-sm-12 p-2">	
                        <div class="card h-100 <%=color%>">
                            <div class="owl-carousel owl-theme mediagallery_scroller" uk-lightbox>
                                <% 
                                String eventtype1=eventLink.getEventtype();
                                String title = eventLink.getTitle();
                                String description = eventLink.getDescription();
                                String location = eventLink.getLocation();
                                String startTime = eventLink.getStartTime();
                                String endTime = eventLink.getEndTime();
                                String startDate = "";
                                String endDate = "";
                                SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");

                                try {	
                                    Date dt = eventLink.getStartDate();
                                    startDate = sdf.format(dt);
                                } catch (Exception e) {
                                    e.printStackTrace();
                                }

                                try {	
                                    Date dt = eventLink.getEndDate();
                                    endDate = sdf.format(dt);
                                } catch (Exception e) {
                                    e.printStackTrace();
                                }

                                for (GalleryDocuments galleryDoc : galleryDocumentsList) {  
                                    String fileUrl = ""; 
                                    long fileEntryId = galleryDoc.getFileEntryId();
                                    if (fileEntryId != 0L) {
                                        try {
                                            fileUrl =EventsPortlet.getFile(fileEntryId, themeDisplay.getScopeGroupId());	  
                                        } catch (Exception e) {
                                            e.printStackTrace();
                                        }
                                    }
                                    %> 
                                    <div class="item">	
                                        <a class="uk-inline" href="<%=fileUrl %>">
                                            <img class="img-fluid img-thumbnail" src="<%=fileUrl %>" alt="">
                                        </a>
                                    </div>					    
                                <% } %>  
                                <%if(yl.size()>0){
	                                	    for (YouTubeLinks youtube : yl) {  
	    	                                    String fileUrl1 = ""; 
	    	                                   youtubelink=youtube.getYoutubelink();
	    	                                   String[] keys= youtubelink.split("=");
	    	   					            if(keys.length>1){
	    	   					    			 System.out.println("keys>>>"+keys[0]);
	    	   					    			 System.out.println("keys>>>"+keys[1]);
	    	   					    	    	 fileUrl1 =" https://img.youtube.com/vi/"+keys[1]+"/0.jpg";
	    	   					    	     }
	    	   					    	     else{
	    	   					    	    	  keys= youtubelink.split("/");
	    	   					    	    	  String key=keys[keys.length-1];
	    	   					    	    	  System.out.println("keys>>>"+key);
	    	   					    	    	  fileUrl1 =" https://img.youtube.com/vi/"+key+"/0.jpg";
	    	   					    	     }
	    	                                    %> 
	    	                                    <div class="item">	
	    	                                        <a class="uk-inline" href="<%=youtubelink %>">
	    	                                            <img class="img-fluid img-thumbnail" src="<%=fileUrl1 %>" alt="">
	    	                                        </a>
	    	                                    </div>					    
	    	                                <% } }%>  		
                            </div>		
                            <div class="card-body">
                                <h5 class="card-title"><%=title %></h5>
                                <ul class="event_detailslist">
                                    <li class="time"><%=startDate %> - <%=endDate %></li>
                                    <li class="location"><%=location %></li>
                                </ul>
                            </div>
                             <p class="card-link"><a href="/eventlist?eventId=<%=eventid%>&eventtype=<%=eventtype1%>">Read More</a></p>
                        </div>	
                    </div>
                    <% x++; %>
                <% }
            } %>
            <div class="col-lg-12 text-center"> <a href="/eventlist?eventtype1=<%="CapacityBuilding"%>" class="black_btn text-center" target="_blank">VIEW ALL</a></div>
        </div>
    </div>
</section>
	
</main>
